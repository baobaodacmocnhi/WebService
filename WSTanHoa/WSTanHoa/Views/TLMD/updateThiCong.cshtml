@model WSTanHoa.Models.MThiCong
@{
    ViewBag.Title = "Cập Nhật Thi Công";
}

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>@ViewBag.Title</title>
<script src="~/Scripts/jquery-3.6.0.min.js"></script>
@Scripts.Render("~/bundles/datepicker")
<script>
    $(document).ready(function () {
        $("#IDQuan").change(function () {
            getPhuong();
        });
    });
    function getTTKH() {
        if ($("#inputDanhBo").val().length == 11)
            $.ajax({
                type: 'GET',
                url: '/TLMD/getTTKH/',
                dataType: 'json',
                data: { DanhBo: $("#inputDanhBo").val() },
                success: function (data) {
                    $("#inputDiemDau").val(data.SoNha);
                    $("#inputDiemCuoi").val(data.SoNha);
                    $("#inputTenDuong").val(data.TenDuong);
                },
                error: function (ex) {
                    alert("Error: " + ex.statusText);
                }
            });
    };
    function getPhuong() {
        $("#IDPhuong").html("");
        $.ajax({
            type: 'GET',
            url: '/TLMD/getPhuong/',
            dataType: 'json',
            data: { Quan: $("#IDQuan").val() },
            success: function (data) {
                $.each(data, function (i, item) {
                    $("#IDPhuong").append($("<option     />").val(item.SoNha).text(item.TenDuong));
                });
            },
            error: function (ex) {
                alert("Error: " + ex.statusText);
            }
        });
    };

</script>
<div class="container bg-light mt-3 py-2 rounded-3 shadow-sm">
    @using (Html.BeginForm("updateThiCong", "TLMD", FormMethod.Post))
    {
        <div class="row">
            <div class="col-2">
                <label for="inputID" class="form-label">@Html.DisplayNameFor(model => model.ID)</label>
                <input type="number" class="form-control" name="inputID" value="@Html.DisplayFor(model => model.ID)" hidden="">
            </div>
            <div class="col-12 mt-3 form-group">
                <label for="inputName" class="form-label">@Html.DisplayNameFor(model => model.Name)</label>
                <input type="text" class="form-control" name="inputName" value="@Html.DisplayFor(model => model.Name)" />
            </div>
            <div class="col-3 mt-3">
                <label for="inputDanhBo" class="form-label">@Html.DisplayNameFor(model => model.DanhBo)</label>
                <input type="text" class="form-control" id="inputDanhBo" name="inputDanhBo" value="@Html.DisplayFor(model => model.DanhBo)" onchange="getTTKH()" />
            </div>
            <div class="col-3 mt-3">
                <label for="inputDiemDau" class="form-label">@Html.DisplayNameFor(model => model.DiemDau)</label>
                <input type="text" class="form-control" id="inputDiemDau" name="inputDiemDau" value="@Html.DisplayFor(model => model.DiemDau)" />
            </div>
            <div class="col-3 mt-3">
                <label for="inputDiemCuoi" class="form-label">@Html.DisplayNameFor(model => model.DiemCuoi)</label>
                <input type="text" class="form-control" id="inputDiemCuoi" name="inputDiemCuoi" value="@Html.DisplayFor(model => model.DiemCuoi)" />
            </div>
            <div class="col-3 mt-3">
                <label for="inputTenDuong" class="form-label">@Html.DisplayNameFor(model => model.TenDuong)</label>
                <input type="text" class="form-control" id="inputTenDuong" name="inputTenDuong" value="@Html.DisplayFor(model => model.TenDuong)" />
            </div>
            <div class="col-4 mt-3">
                <label for="inputIDQuan" class="form-label">@Html.DisplayNameFor(model => model.IDQuan)</label>
                @Html.DropDownListFor(model => model.IDQuan, ViewBag.Quan as SelectList, new { @class = "form-control", @onchange = "" })
            </div>
            <div class="col-4 mt-3">
                <label for="inputIDPhuong" class="form-label">@Html.DisplayNameFor(model => model.IDPhuong)</label>
                @Html.DropDownListFor(model => model.IDPhuong, ViewBag.Phuong as SelectList, new { @class = "form-control" })
                @*<select class="form-control" id="IDPhuong" name="IDPhuong"></select>*@
                <input type="text" class="form-control" id="IDPhuongHide" name="IDPhuongHide" value="@Html.DisplayFor(model => model.IDPhuong)" hidden="hidden" />
            </div>
            <div class="col-4 mt-3">
                <label for="inputIDKetCau" class="form-label">@Html.DisplayNameFor(model => model.IDKetCau)</label>
                @*<input type="text" class="form-control" name="inputIDKetCau" value="@Html.DisplayFor(model => model.IDKetCau)" />*@
                @Html.DropDownListFor(model => model.IDKetCau, ViewBag.KetCau as SelectList, new { @class = "form-control" })
            </div>
            <div class="col-6 mt-3">
                <label for="inputIDDonViThiCong" class="form-label">@Html.DisplayNameFor(model => model.IDDonViThiCong)</label>
                @*<input type="text" class="form-control" name="inputIDDonViThiCong" value="@Html.DisplayFor(model => model.IDDonViThiCong)" />*@
                @Html.DropDownListFor(model => model.IDDonViThiCong, ViewBag.DonViThiCong as SelectList, new { @class = "form-control" })
            </div>
            <div class="col-6 mt-3">
                <label for="inputNgayBatDau" class="form-label">@Html.DisplayNameFor(model => model.NgayBatDau)</label>
                <input type="text" class="datepicker form-control" id="inputNgayBatDau" name="inputNgayBatDau" value="@Html.DisplayFor(model => model.NgayBatDau)" />
            </div>
            @if (Model == null || Model.ID <= 0)
            {
            }
            else
            {
                <div class="col-6 mt-3">
                    <label for="inputCreateBy" class="form-label">@Html.DisplayNameFor(model => model.CreateBy)</label>
                    <input type="text" class="form-control" id="inputCreateBy" name="inputCreateBy" value="@Html.DisplayFor(model => model.CreateBy)" readonly />
                </div>
                <div class="col-6 mt-3">
                    <label for="inputCreateDate" class="form-label">@Html.DisplayNameFor(model => model.CreateDate)</label>
                    <input type="text" class="form-control" id="inputCreateDate" name="inputCreateDate" value="@Html.DisplayFor(model => model.CreateDate)" readonly />
                </div>
            }
        </div>
        <div class="row">
            <div class="col mt-3">
                @if (Model == null || Model.ID <= 0)
                {
                    <button type="submit" name="Loai" value="insert" class="btn btn-primary">Thêm mới</button>
                }
                else
                {
                    <button type="submit" name="Loai" value="update" class="btn btn-primary">Cập nhật</button>
                }
            </div>
        </div>
        <div class="row">
            <div class="container bg-white mt-3 py-2 rounded-3 shadow-sm">
                <h4>Kết quả tái lập</h4>
                @if (Model != null && Model.lstLichSu.Count > 0)
                {
                    foreach (var item in Model.lstLichSu)
                    {
                        <div class="card shadow mb-4">
                            <!-- Card Header - Dropdown -->
                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                <h6 class="m-0 font-weight-bold text-primary">@item.Name</h6>
                            </div>
                            <!-- Card Body -->
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6 form-group">
                                        <label for="inputNgayKetThuc" class="form-label">@Html.DisplayNameFor(model => model.lstLichSu[0].NgayKetThuc)</label>
                                        <input type="text" class="form-control" name="inputNgayKetThuc" value="@item.NgayKetThuc" />
                                    </div>
                                    <div class="col-6 form-group">
                                        <label for="inputNgayNghiemThu" class="form-label">@Html.DisplayNameFor(model => model.lstLichSu[0].NgayNghiemThu)</label>
                                        <input type="text" class="form-control" name="inputNgayNghiemThu" value="@item.NgayNghiemThu" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6 form-group">
                                        <label for="inputName" class="form-label">@Html.DisplayNameFor(model => model.lstLichSu[0].TroNgaiThiCong)</label>
                                        <input type="text" class="form-control" name="inputTroNgaiThiCong" value="@item.TroNgaiThiCong" />
                                    </div>
                                    <div class="col-6 form-group">
                                        <label for="inputName" class="form-label">@Html.DisplayNameFor(model => model.lstLichSu[0].TroNgaiNghiemThu)</label>
                                        <input type="text" class="form-control" name="inputTroNgaiNghiemThu" value="@item.TroNgaiNghiemThu" />
                                    </div>
                                </div>
                                <div class="row">
                                    @foreach (var itemHinh in item.lstLichSu_Hinh)
                                    {
                                        <div class="col">
                                            <img src="@itemHinh.image" height="100" width="100" data-bs-toggle="modal" data-bs-target="#exampleModal" />
                                        </div>
                                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-body">
                                                        <img src="@itemHinh.image" height="1000" width="1000" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>


        </div>

    }
</div>
